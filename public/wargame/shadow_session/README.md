# Shadow Session

## 문제 설명

관리자 전용 컴퓨터에 로그인하려면 ID와 PW를 입력해야 한다.  
하지만 이 시스템에는 치명적인 구조적 문제가 숨어 있다.  
바로 세션 ID를 외부에서 조작할 수 있다는 점이다.

로그인 성공 여부는 세션 상태에 따라 결정되며,  
서버는 클라이언트가 제출한 `sid` 파라미터를 그대로 세션 ID로 사용한다.  
만약 공격자가 특정 세션을 먼저 만들고 피해자도 그 세션을 사용하도록 유도한다면?  
둘은 동일한 세션을 공유하게 된다.  
그 세션이 이미 로그인 상태라면, 피해자도 로그인된 것처럼 인식된다.

이 문제는 **Session Fixation** 취약점을 기반으로 설계되었다.

## 목표

`admin.php`에 접근하여 플래그를 획득하라.

## 구성 파일

- `login.php`: 로그인 처리 및 세션 설정
- `flag.php`: 인증된 세션에만 플래그 제공
- `hint.txt`: 힌트 문서 (선택적으로 표시 가능)

## 취약점 요약

```php
if (isset($_GET["sid"])) {
    session_id($_GET["sid"]); // 외부 입력값으로 세션 고정
}
session_start();
```

서버가 클라이언트가 제공한 세션 ID를 그대로 받아들임으로써  
**세션 고정(Session Fixation)** 공격이 가능해진다.

## 풀이 절차

1. 공격자는 고정된 세션 ID (`sid=evil`)를 가진 URL로 로그인 페이지에 접속한다.
   ```
   http://host/login.php?sid=evil
   ```
2. 다음으로 관리자 계정으로 로그인한다.
   ```
   ID: admin
   PW: admin1234
   ```
3. 이 시점에 `sid=evil` 세션에 `auth=true`가 설정된다.
4. 이후 아무 사용자가 `http://host/flag.php?sid=evil`로 접근하면 플래그를 얻을 수 있다.

## 예시 플래그

```
CPS{session_fixation_attack_done}
```

## 대응 방안 (보안 지식 확장용)

- 세션 ID는 클라이언트가 직접 주입할 수 없도록 해야 한다.
- 로그인 후에는 반드시 `session_regenerate_id()`를 호출하여 새 세션을 생성해야 한다.
- 가능한 경우 쿠키 기반 세션만을 허용하도록 서버를 구성한다.
